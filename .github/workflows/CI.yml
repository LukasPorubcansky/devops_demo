name: CI

on:
  workflow_dispatch:
    inputs:
      dev:
        type: boolean
        description: "DEV"
        default: True

      test:
        type: boolean
        description: "TEST"
        default: True

      stage:
        type: boolean
        description: "STAGE"
        default: True

      prod:
        type: boolean
        description: "PROD"
        default: True

      app_version:
        description: "Version"
        required: True
        type: choice
        default: '1.0.0'
        options:
        - '1.0.0'
        - '1.0.1'
        - '1.0.2'

pool:
  vmImage: ubuntu-latest

stages:
- stage: BuildApp
  displayName: Build Apps
  jobs:
  - job: BuildFrontendApp
    displayName: Build Frontend App
    steps:
    - script: echo building frontend app
      displayName: build frontend app
    - script: echo running unit tests for frontend app
      displayName: unit tests frontend

  - job: BuildBackendApp
    displayName: Build Backend App
    steps:
    - script: echo building backend app
      displayName: build backend app
    - script: echo running unit tests for backend app
      displayName: unit tests backend

- stage: DeployDev
  displayName: Deploy to DEV environment
  jobs:
  - job: DeployFrontendDev
    displayName: Deploy frontend to DEV
    steps:
    - script: echo deploying frontend app to DEV
      displayName: deploy frontend app to DEV

  - job: DeployBackendDev
    displayName: Deploy backend to DEV
    steps:
    - script: echo deploying backend app to DEV
      displayName: deploy backend app to DEV

- stage: DeployProd
  displayName: Deploy to PROD environment
  pool:
    vmImage: 'macOS-10.14'
  jobs:
  - job: DeployFrontendProd
    displayName: Deploy frontend to PROD
    steps:
    - script: echo deploying frontend app to PROD
      displayName: deploy frontend app to PROD

  - job: DeployBackendProd
    displayName: Deploy backend to PROD
    pool:
      vmImage: 'vs2017-win2016'
    steps:
    - script: echo deploying backend app to PROD
      displayName: deploy backend app to PROD
